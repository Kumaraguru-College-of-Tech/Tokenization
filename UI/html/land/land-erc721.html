<!-- 
    Author       : Sowbharnika K and Ramaguru R
    Date Created : 28.12.2020
    Date Updated : 16.01.2021
-->
	

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Land ERC721</title>
    <link rel="stylesheet" href="fonts/material-icon/css/material-design-iconic-font.min.css">
    <link rel="stylesheet" href="../../css/style.css">
    <script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script>
<style>

body{
  margin:0;
  padding: 0;
  background: linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.35)), url(https://i.ytimg.com/vi/OUF6Cc_7qwM/maxresdefault.jpg) no-repeat center center fixed;
  background-size:cover;
  color: black;
  font-family: "open sans";
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  
  font-family: "Trebuchet MS", Helvetica, sans-serif;
  font-size:15px;
  letter-spacing: 2px;
  word-spacing: 2px;
  color: #000000;
  font-weight: 800;
  font-style: normal;
  font-variant: normal;
  text-transform: capitalize;
}

</style>	
</head>

<body>

   <header>
	<div>
    <img src="../../images/land-logo.png" style="height:70px; width:80px;" />
    &nbsp;<h3>Land Registrar </h3> 
	</div>
	
	<nav >
      <ul >
        <li><a href="../index.html">Home</a></li>
        <li><a href="land-usecase.html">Back</a></li>
      </ul>
    </nav>
  </header>
  
    <div class="main">

        <!-- Land Details Registration -->
        <section class="issue">
            <div class="container">
                <div class="issue-content" id="issueDiv">
                    <div class="issue-form" style="width:80%;">
                        <h2 class="form-title"> Land Details Registration</h2>
                        <form  class="issue-form" id="issue-form">
						
			   <!--<div class="form-group" >
                            <label ><span class="iconify" data-icon="zmdi:format-list-numbered" data-inline="false"></span></span></span></label>
                            <input type="text" id="landid" placeholder="Land ID"/>
                            </div>-->
							
                            <div class="form-group">
                                <label ><span class="iconify" data-icon="zmdi:landscape" data-inline="false"></span></i></label>
                                <input type="text"  id="landtype" placeholder="Land Type(eg: Commercial)"/>
                            </div>
							
                            <div class="form-group">
                                <label ><span class="iconify" data-icon="zmdi:google-maps" data-inline="false"></span></i></label>
                                <input type="text" id="landloc" placeholder="Land Location"/>
                            </div>
		
			  <div class="form-group">
                <label><span class="iconify" data-icon="zmdi:assignment-check" data-inline="false"></span></label>
                <input type="text"  id="landloctype" placeholder="Land Location Type (eg: Urban)"/>
                            </div>
							
			  <div class="form-group">
                <label ><span class="iconify" data-icon="zmdi:equalizer" data-inline="false"></span></i></label>
                <input type="text" id="landsize" placeholder="Land Size with Units (eg:1000 Sq.ft)"/>
                            </div>
							
							<div class="form-group">
                                <label ><span class="iconify" data-icon="zmdi:label-alt-outline" data-inline="false"></span></label>
                                <input type="text" id="landbdet" placeholder="Land Boundary Detail"/>
                            </div>
	                     <div class="form-group">
                                <label ><span class="iconify" data-icon="zmdi:navigation" data-inline="false"></span></label>
                                <input type="text" id="landlatdet" placeholder="Land Latitude Detail"/>
                            </div>
	                     <div class="form-group">
                                <label ><span class="iconify" data-icon="zmdi:navigation" data-inline="false"></span></label>
                                <input type="text" id="landlongdet" placeholder="Land Longitude Detail"/>
                            </div>
							
							<div class="form-group">
							   
                                <label ><span class="iconify" data-icon="zmdi:shield-check" data-inline="false"></span></label>
                                <input type="number" id="pattano" placeholder="Land Patta No"/>
                            </div>
                            <div class="form-group">
							   
                                <label ><span class="iconify" data-icon="zmdi:search-in-file" data-inline="false"></span></label>
                                <input type="number" id="docno" placeholder="Land Document No"/>
                            </div>
                            <div class="form-group">
							   
                                <label ><span class="iconify" data-icon="zmdi:accounts-outline" data-inline="false"></span></label>
                                <input type="text" id="landown" placeholder="Land Owner Wallet Address"/>
                            </div>
							
                            
                            <div class="btn">
                                <input type="button" onclick="register_land()" value="Register Land Details" 
								style="width:25%;
								background-color: #03fc6f;
								border: 2px solid;
								border-radius: 0.6em;
								font-family: Trebuchet MS, Helvetica, sans-serif;
								color: white;
								padding: 10px 15px;
								text-decoration: none;
								margin: 4px 2px;
								cursor: pointer;
								color: #fff;
								box-shadow: 0 0 40px 40px #3498db inset, 0 0 0 0 #3498db;
								-webkit-transition: all 150ms ease-in-out;
								transition: all 150ms ease-in-out;"/>
                            </div>
							
							<div style="float:right;color:#0f7536;">
							<b>Want to modify a Registered Land Details?</b>
							<div class="btn">
                                <input type="button" onclick="show_modify()" value="Modify Land Details" 
								style="width:65%;
								background-color: #521c94;
								border: 2px solid;
								border-radius: 0.6em;
								font-family: Trebuchet MS, Helvetica, sans-serif;
								color: white;
								padding: 10px 15px;
								text-decoration: none;
								margin: 4px 2px;
								cursor: pointer;
								color: #fff;
								box-shadow: 0 0 40px 40px #3498db inset, 0 0 0 0 #3498db;
								-webkit-transition: all 150ms ease-in-out;
								transition: all 150ms ease-in-out;"/>
                            </div>
			</div> 
                        </form>
						</div>
						</div>
						
	
		<!-- Modify Land Details -->
					<div class="modify-content" id="modifyDiv" style="padding-right:80px;display:none;">
					<div class="modify-form">
                        <h2 class="form-title">Modify Land Details</h2>
                        <form  class="register-form" >
                            <div class="form-group">
                               <table>
                                <tr><td><input type="text" id="mtokenID" placeholder="Enter Land ID" /></td>
								<td><input type="button" class="iconify" data-icon="zmdi:search" style="height:15%;width:15%" onclick="getdetails()"/></td></tr>
                            </table>
			   </div>
                            <div>
							<table >
								<tr><td style="width:50%;height:20px;"> <b>Land Type :</b>   <input type="text"  id="mlandtype" /></td></tr>
								<tr><td style="width:50%;height:20px;padding-top:15px;"> <b>Land Location :</b>   <input type="text" id="mlandloct" /> </td></tr>
								<tr><td style="width:50%;height:20px;padding-top:15px;"> <b>Land Location Type :</b>     <input type="text" id="mlandloctype"/></td></tr>
								<tr><td style="width:50%;height:20px;padding-top:15px;"> <b>Land Size :</b>  <input type="text" id="mlandsize" /></td></tr>
                                <tr><td style="width:50%;height:20px;padding-top:15px;"> <b>Land Boundary Details :</b>   <input type="text" id="mlandbdet" /></td></tr>
			        <tr><td style="width:50%;height:20px;padding-top:15px;"> <b>Land Latitude Details :</b>   <input type="text" id="mlandlatdet" /></td></tr>
				<tr><td style="width:50%;height:20px;padding-top:15px;"> <b>Land Longitude Details :</b>   <input type="text" id="mlandlongdet" /></td></tr>
                                <tr><td style="width:50%;height:20px;padding-top:15px;"> <b>Land Patta No :</b>   <input type="number" id="mpattano" /></td></tr>
                                <tr><td style="width:50%;height:20px;padding-top:15px;"> <b>Land Document No :</b>   <input type="number" id="mdocno" /></td></tr>
								<tr><td style="width:50%;height:20px;padding-top:15px;"> <b>Land Owner Wallet Address :</b>    <input type="text" id="mlandown" /></td></tr>
							</table>
							</div><br><br>
                            
							 <div class="btn">
                                <input type="button" onclick="modify_land()" value="Modify Land Details" 
								style="width:25%;
								background-color: #03fc6f;
								border: 2px solid;
								font-family: Trebuchet MS, Helvetica, sans-serif;
								border-radius: 0.6em;
								color: white;
								padding: 10px 15px;
								text-decoration: none;
								margin: 4px 2px;
								cursor: pointer;
								color: #fff;
								box-shadow: 0 0 40px 40px #3498db inset, 0 0 0 0 #3498db;
								-webkit-transition: all 150ms ease-in-out;
								transition: all 150ms ease-in-out;"/>
                            </div>
							<div style="float:right; padding:60px;color:#0f7536;">
							<b>Want to Register a new Land?</b>
							<div class="btn">
                                <input type="button" onclick="show_issue()" value="Register Land Details" 
								style="width:65%;
								background-color: #521c94;
								border: 2px solid;
								font-family: Trebuchet MS, Helvetica, sans-serif;
								border-radius: 0.6em;
								color: white;
								padding: 10px 15px;
								text-decoration: none;
								margin: 4px 2px;
								cursor: pointer;
								color: #fff;
								box-shadow: 0 0 40px 40px #3498db inset, 0 0 0 0 #3498db;
								-webkit-transition: all 150ms ease-in-out;
								transition: all 150ms ease-in-out;"/>
                         </div>
			</div>
                        </form> 
                    </div>
		</div>	  
                </div>  
        </section>


        <!-- View Land Details -->
        <section class="retrieve">
            <div class="container">
                <div class="retrieve-content">
                    <div class="retrieve-image">
                        <figure><img src="../../images/land-view.jpg" alt="verify image"></figure>
                    </div>

                    <div class="retrieve-form">
                        <h2 class="form-title">View Land Details</h2>
                        <form  class="register-form" >
                            <div class="form-group">
                                <label for="your_name"><span class="iconify" data-icon="zmdi:labels" data-inline="false"></span></label>
                                <input type="text" id="lid" placeholder="Land ID"/>
                            </div>
				<div class="btn">
                                <input type="button" onclick="view_landdetails()" value="View Land Details"
								style="width:45%;
								background-color: #a8203c;
								border: 2px solid;
								font-family: Trebuchet MS, Helvetica, sans-serif;
								border-radius: 0.6em;
								color: white;
								padding: 10px 15px;
								text-decoration: none;
								margin: 4px 2px;
								cursor: pointer;
								color: #fff;
								box-shadow: 0 0 40px 40px #3498db inset, 0 0 0 0 #3498db;
								-webkit-transition: all 150ms ease-in-out;
								transition: all 150ms ease-in-out;"/>
                            </div>
                            <div>
							<table >
								<tr><td style="width:50%;height:30px;"> Land Type :   <div id="ltype" style="color:green;"></div> </td></tr>
								<tr><td style="width:50%;height:30px;"> Land Location :  <div id="lloc" style="color:green;"></div> </td></tr>
								<tr><td style="width:50%;height:30px;"> Land Location Type :   <div id="ltype" style="color:green;"></div></td></tr>
								<tr><td style="width:50%;height:30px;"> Land Size :  <div id="lsize" style="color:green;"></div> </td></tr>
                                				<tr><td style="width:50%;height:30px;"> Land Boundary Details :   <div id="lbdet" style="color:green;"></div> </td></tr>
                                				<tr><td style="width:50%;height:30px;"> Land Longitude Details :   <div id="llong" style="color:green;"></div> </td></tr>
								<tr><td style="width:50%;height:30px;"> Land Latitude Details :   <div id="llat" style="color:green;"></div> </td></tr>
								<tr><td style="width:50%;height:30px;"> Land Patta No :   <div id="lpattano" style="color:green;"></div> </td></tr>
                                				<tr><td style="width:50%;height:30px;"> Land Document No :   <div id="ldocno" style="color:green;"></div> </td></tr>
								<tr><td style="width:50%;height:30px;"> Land Owner Wallet Address :  <div id="lholder" style="color:green;"></div></td></tr>
							</table>
							</div><br>
                            
                        </form>
                        
                    </div>
                </div>
            </div>
        </section>

    </div>

    <!-- JS -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="../../js/main.js"></script>
	
	<script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.js"></script>
    <script>	
	
	var account;
	window.addEventListener('load', async () => {

	
		if (typeof window.ethereum !== 'undefined') { 
			console.log("MetaMask is Available :) !"); 
			}
			
		// Modern DApp browsers
		if (window.ethereum) {
			window.web3 = new Web3(ethereum);
			
			// To prevent the page reloading when the MetaMask network changes
			ethereum.autoRefreshOnNetworkChange = false;
			
			// To Capture the account details from MetaMask
			const accounts = await ethereum.enable();
			account = accounts[0];
			
			}
			
		// Legacy DApp browsers
		else if (window.web3) {
			//window.web3 = new Web3(web3.currentProvider);
			window.web3 = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/v3/cbd9dc11b30147e9a2cc974be655ef7c")); 
			}
			
		// Non-DApp browsers
		else {
			console.log('Non-Ethereum browser detected. Please install MetaMask');
			}
			
			loadstatus();
			
			});
		
				
		    // Function to get the status about ERC-721 Token
			function loadstatus() {
					
				console.log("Invoking Smart Contracts - Status...");
						
				//Instantiate and connect to contract address via ABI
				var myContract = new web3.eth.Contract(land_abi,land_contractaddress, {from: account, gasPrice: '5000000', gas: '30000000'});
				
				//call the "totalSupply" function
				var result = myContract.methods.totalSupply().call(function (err, result) {
				
				if (err) { console.log(err); }
				if (result) { document.getElementById("tsupply").innerHTML = result; }
				
				});
					
			
				}

			// Function to call the "Land Details Registeration" in Deployed Smart Contract
			function register_land() {
					
				console.log("Registering land details");
						
				//Instantiate and connect to contract address via ABI
				var myContract = new web3.eth.Contract(land_abi,land_contractaddress, {from: account, gasPrice: '5000000', gas: '3000000'});
								
				var typ = document.getElementById("landtype").value;
				var loc = document.getElementById("landloc").value;
				var loctyp = document.getElementById("landloctype").value;
				var size = document.getElementById("landsize").value;
				var bdet = document.getElementById("landbdet").value;
				var latdet = document.getElementById("landlatdet").value;
				var longdet = document.getElementById("landlongdet").value;
				var pno = document.getElementById("pattano").value;
                		var dno = document.getElementById("docno").value;
                		var address = document.getElementById("landown").value;
                		//var id = document.getElementById("landid").value;
				
				
				//call the "Land Details Registeration" function
				result = myContract.methods.issueLand(typ, loc, loctyp, size, bdet, latdet, longdet, pno, dno, address).send(function (err, result) {
				
				if (err) { console.log(err); }
				//if (result) { document.getElementById("transresult").innerHTML = result; }
				
				});
					
			}
			
            // Function to call the "Modify Land Details" in Deployed Smart Contract
			function modify_land() {
					
                    console.log("Modifying Land Details");
                            
                    //Instantiate and connect to contract address via ABI
                    var myContract = new web3.eth.Contract(land_abi,land_contractaddress, {from: account, gasPrice: '5000000', gas: '3000000'});
                    
		    var id = document.getElementById("mtokenID").value;                
                    var type = document.getElementById("mlandtype").value;
                    var loc = document.getElementById("mlandloc").value;
                    var loctyp = document.getElementById("mlandloctype").value;
                    var size = document.getElementById("mlandsize").value;
                    var bdet = document.getElementById("mlandbdet").value;
		    var latdet = document.getElementById("mlandlatdet").value;
		    var longdet = document.getElementById("mlandlongdet").value;
                    var pno = document.getElementById("mpattano").value;
                    var dno = document.getElementById("mdocno").value;
                    var address = document.getElementById("mlandown").value;
                    
                    //var ipfshash = document.getElementById("ipfshash").value;
                    
                    //call the "register land" function
                    result = myContract.methods.updateLand(id, type, loc, loctyp, size, bdet, latdet, longdet, pno, dno, address).send(function (err, result) {
                    
                    if (err) { 
                        console.log(err);
                        
                         }
                    if (result) { 
                       
                    }
                    
                    });
                        
                }
                
		
			// Functions to show and hide appropiate div 
			function show_issue() {
			
			var modifyDiv = document.getElementById("modifyDiv");
			modifyDiv.style.display = "none";
			var issueDiv = document.getElementById("issueDiv");
			issueDiv.style.display= "block";
			
			}
			
			function show_modify() {
			
			var issueDiv = document.getElementById("issueDiv");
			issueDiv.style.display = "none";
			var modifyDiv = document.getElementById("modifyDiv");
			modifyDiv.style.display = "block";
			
			}	
		
			// Functions to call the "View Land Details" in Deployed Smart Contract
			function view_landdetails() {
					
				console.log("Getting Land Details");
						
				//Instantiate and connect to contract address via ABI
				var myContract = new web3.eth.Contract(land_abi,land_contractaddress, {from: account, gasPrice: '5000000', gas: '30000000'});
								
				var tokenID = document.getElementById("tokenIDd").value;
				
				//call the "View Land Details" function
				var result = myContract.methods.retrieveLand(tokenID).call(function (err, result) {
				
				if (err) { console.log(err); }
				if (result) { 
				
					document.getElementById("landtype").innerHTML = result[0]; 
					document.getElementById("landloc").innerHTML = result[1]; 
					document.getElementById("landloctype").innerHTML = result[2]; 
					document.getElementById("landsize").innerHTML = result[3];
					document.getElementById("landbdet").innerHTML = result[4];
					document.getElementById("landlatdet").innerHTML = result[5];
					document.getElementById("landlongdet").innerHTML = result[6];
					document.getElementById("pattano").innerHTML = result[7]; 
                    			document.getElementById("docno").innerHTML = result[8];
                    			document.getElementById("landown").innerHTML = result[9];
                    			document.getElementById("landid").innerHTML = result[10];
				
				}
				
				});
					
			}
			
            function getdetails() {
					
                    console.log("Getting Land Details ");
                            
                    //Instantiate and connect to contract address via ABI
                    var myContract = new web3.eth.Contract(land_abi,land_contractaddress, {from: account, gasPrice: '5000000', gas: '30000000'});
                                    
                    var tokenID = document.getElementById("mtokenID").value;
                    
                    //call the "view land details" function
                    var result = myContract.methods.retrieveLand(tokenID).call(function (err, result) {
                    
                    if (err) { console.log(err); }
                    if (result) { 
                    
                    			document.getElementById("mlandtype").value = result[0]; 
					document.getElementById("mlandloc").value= result[1]; 
					document.getElementById("mlandloctype").value = result[2]; 
					document.getElementById("mlandsize").value = result[3];
					document.getElementById("mlandbdet").value = result[4]; 
			                document.getElementById("mlandlatdet").value = result[5];
			                document.getElementById("mlandlongdet").value = result[6];
					document.getElementById("mpattano").value = result[7]; 
                    			document.getElementById("mdocno").value = result[8];
                    			document.getElementById("mlandown").value = result[9];
                    }
                    
                    });
                        
                }
			
    </script>
	
</body>
</html>
